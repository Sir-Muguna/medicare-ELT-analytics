# models/staging/stg_schema.yml
version: 2

models:
  - name: stg_medicare_data
    description: "Cleaned and standardized Medicare Part D prescription drug data"
    columns:
      - name: _airbyte_raw_id
        description: "Airbyte unique record identifier (from source)"
        
      - name: _airbyte_extracted_at
        description: "Data extraction timestamp (from source)"
        
      - name: drug_key
        description: "MD5 hash of brand and generic name for unique drug identification"
          
      - name: brnd_name
        description: "Cleaned brand name of the prescribed drug"
        tests:
          - not_null
          
      - name: gnrc_name
        description: "Cleaned generic name of the prescribed drug"
        tests:
          - not_null
          
      - name: tot_clms
        description: "Total number of claims submitted (converted to integer)"
        
      - name: tot_benes
        description: "Total number of medicare beneficiaries (converted to integer)"
        
      - name: tot_prscrbrs
        description: "Total number of prescribing physicians (converted to integer)"
        
      - name: tot_30day_fills
        description: "Total number of 30-day medication fills (converted to float)"
        
      - name: tot_drug_cst
        description: "Total cost of the drug claims (converted to float)"
        
      - name: lis_bene_cst_shr
        description: "Low-income subsidy cost share amount (converted to float)"
        
      - name: nonlis_bene_cst_shr
        description: "Non-low-income subsidy cost share (converted to float)"
        
      - name: ge65_tot_clms
        description: "Total claims for beneficiaries aged 65+ (converted to integer)"
        
      - name: ge65_tot_benes
        description: "Total beneficiaries aged 65 and older (converted to integer)"
        
      - name: ge65_tot_30day_fills
        description: "30-day fills for 65+ beneficiaries (converted to float)"
        
      - name: ge65_tot_drug_cst
        description: "Total drug cost for 65+ beneficiaries (converted to float)"
        
      - name: is_antibiotic_drug
        description: "Boolean flag indicating if drug is an antibiotic"
        
      - name: is_opioid_drug
        description: "Boolean flag indicating if drug is an opioid"
        
      - name: is_long_acting_opioid
        description: "Boolean flag indicating if drug is a long-acting opioid"
        
      - name: is_antipsychotic_drug
        description: "Boolean flag indicating if drug is an antipsychotic"
        
      - name: is_ge65_suppressed
        description: "Boolean flag indicating if 65+ data is suppressed"
        
      - name: is_ge65_beneficiary_suppressed
        description: "Boolean flag indicating if 65+ beneficiary count is suppressed"
        
      - name: prescriber_geo_level
        description: "Geographic level of the data aggregation (hardcoded as NATIONAL)"
        
      - name: prescriber_geo_description
        description: "Description of geographic level (hardcoded as NATIONAL)"

  - name: stg_icd_11_codes
    description: "Cleaned and standardized ICD-11 disease classification codes"
    columns:
      - name: _airbyte_raw_id
        description: "Airbyte unique record identifier (from source)"
        
      - name: _airbyte_extracted_at
        description: "Data extraction timestamp (from source)"
        
      - name: icd_code
        description: "Standardized ICD-11 disease classification code"
        tests:
          - unique
          
      - name: disease_title
        description: "Cleaned disease description and title"
        tests:
          - not_null
          
      - name: is_leaf_node
        description: "Boolean indicating if code is a leaf node in hierarchy"
        
      - name: chapter_number
        description: "Chapter number for classification (1-26)"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 26
              
      - name: hierarchy_depth
        description: "Depth level in classification hierarchy (1-8)"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 8
              
      - name: classification_kind
        description: "Type of classification category"
        
      - name: primary_grouping
        description: "Primary grouping category"
        
      - name: secondary_grouping
        description: "Secondary grouping category"
        
      - name: is_residual_category
        description: "Boolean indicating if this is a residual category"
        
      - name: is_primary_tabulation
        description: "Boolean flag for primary tabulation"
        
      - name: foundation_ontology_uri
        description: "Foundation ontology URI reference"
        
      - name: linearization_uri
        description: "Linearization reference URI"

  - name: stg_hospital_general_info  
    description: "Cleaned and standardized hospital general information with quality metrics"
    columns:
      - name: provider_id
        description: "Unique hospital identifier"
        tests:
          - not_null
          - unique
          
      - name: hospital_name
        description: "Name of healthcare facility"
        tests:
          - not_null
          
      - name: address
        description: "Street address of hospital"
        
      - name: city
        description: "City where hospital is located"
        
      - name: state
        description: "State where hospital is located"
        
      - name: zip_code
        description: "Postal zip code"
        
      - name: county_name
        description: "County where hospital is located"
        
      - name: phone_number
        description: "Contact phone number"
        
      - name: hospital_type
        description: "Type of hospital facility"
        
      - name: hospital_ownership
        description: "Ownership type of hospital"
        
      - name: has_emergency_services
        description: "Boolean indicating if hospital has emergency services"
        
      - name: meets_ehr_interoperability_criteria
        description: "Boolean indicating EHR interoperability compliance"
        
      - name: hospital_overall_rating
        description: "Overall quality rating (1-5 scale)"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 5
                
      - name: safety_measures_count
        description: "Total number of safety measures"
        
      - name: readmission_measures_count
        description: "Total number of readmission measures"
        
      - name: safety_measures_worse_count
        description: "Number of safety measures performing worse than average"
        
      - name: safety_measures_better_count
        description: "Number of safety measures performing better than average"
        
      - name: mortality_group_measure_count
        description: "Total number of mortality measures"
        
      - name: mortality_measures_worse_count
        description: "Number of mortality measures performing worse than average"
        
      - name: mortality_measures_better_count
        description: "Number of mortality measures performing better than average"
        
      - name: readmission_measures_worse_count
        description: "Number of readmission measures performing worse than average"
        
      - name: patient_experience_measures_count
        description: "Total number of patient experience measures"
        
      - name: readmission_measures_better_count
        description: "Number of readmission measures performing better than average"
        
      - name: facility_mortality_measures_count
        description: "Number of facility-specific mortality measures"
        
      - name: safety_measures_no_different_count
        description: "Number of safety measures with no significant difference"
        
      - name: facility_care_safety_measures_count
        description: "Number of facility care safety measures"
        
      - name: facility_readmission_measures_count
        description: "Number of facility readmission measures"
        
      - name: mortality_measures_no_different_count
        description: "Number of mortality measures with no significant difference"
        
      - name: readmission_measures_no_different_count
        description: "Number of readmission measures with no significant difference"
        
      - name: timely_care_measures_count
        description: "Total number of timely and effective care measures"
        
      - name: facility_patient_experience_measures_count
        description: "Number of facility patient experience measures"
        
      - name: facility_timely_care_measures_count
        description: "Number of facility timely and effective care measures"
        
      - name: hospital_overall_rating_footnote
        description: "Footnote for overall rating"
        
      - name: patient_experience_measures_footnote
        description: "Footnote for patient experience measures"